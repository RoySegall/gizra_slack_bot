<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Black box task - Nnutius documentation</title>
    <meta name="description" content="Develop smart bot easily" />
    <meta name="author" content="I, Me & Myself">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-blue.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-blue.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">Nnutius documentation</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../Nuntius_Slack_Bot.html">Nuntius Slack Bot</a></li><li class='Nav__item '><a href="../Events.html">Events</a></li><li class='Nav__item '><a href="../Entities.html">Entities</a></li><li class='Nav__item '><a href="../Multiple_bots_and_context_manager.html">Multiple bots and context manager</a></li><li class='Nav__item Nav__item--open has-children'><a href="../Tasks/introduction.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Tasks</a><ul class='Nav'><li class='Nav__item '><a href="../Tasks/introduction.html">introduction</a></li><li class='Nav__item Nav__item--active'><a href="../Tasks/Black_box_task.html">Black box task</a></li><li class='Nav__item '><a href="../Tasks/Conversation_task.html">Conversation task</a></li><li class='Nav__item '><a href="../Tasks/Validating_user_input.html">Validating user input</a></li></ul></li><li class='Nav__item '><a href="../Updates.html">Updates</a></li><li class='Nav__item '><a href="../Commands.html">Commands</a></li><li class='Nav__item  has-children'><a href="../Webhooks/What_is_webhook.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Webhooks</a><ul class='Nav'><li class='Nav__item '><a href="../Webhooks/What_is_webhook.html">What is webhook</a></li><li class='Nav__item '><a href="../Webhooks/Adding_webhook_support.html">Adding webhook support</a></li><li class='Nav__item '><a href="../Webhooks/Local_wotk_with_webhooks.html">Local wotk with webhooks</a></li><li class='Nav__item  has-children'><a href="../Webhooks/Facebook/Configure_the_integration.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Facebook</a><ul class='Nav'><li class='Nav__item '><a href="../Webhooks/Facebook/Configure_the_integration.html">Configure the integration</a></li><li class='Nav__item '><a href="../Webhooks/Facebook/How_to_implement.html">How to implement</a></li></ul></li><li class='Nav__item  has-children'><a href="../Webhooks/GitHub/Configure_the_integration.html" class="folder"><i class="Nav__arrow">&nbsp;</i>GitHub</a><ul class='Nav'><li class='Nav__item '><a href="../Webhooks/GitHub/Configure_the_integration.html">Configure the integration</a></li><li class='Nav__item '><a href="../Webhooks/GitHub/Add_events_integration.html">Add events integration</a></li></ul></li></ul></li><li class='Nav__item '><a href="../Services.html">Services</a></li><li class='Nav__item '><a href="../Cron_tasks.html">Cron tasks</a></li><li class='Nav__item  has-children'><a href="../The_DB_layer/Intorduction.html" class="folder"><i class="Nav__arrow">&nbsp;</i>The DB layer</a><ul class='Nav'><li class='Nav__item '><a href="../The_DB_layer/Intorduction.html">Intorduction</a></li><li class='Nav__item '><a href="../The_DB_layer/Deep_into_the_rabbit_hole.html">Deep into the rabbit hole</a></li><li class='Nav__item  has-children'><a href="../The_DB_layer/Writing_a_custom_driver/Writing_a_custom_driver.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Writing a custom driver</a><ul class='Nav'><li class='Nav__item '><a href="../The_DB_layer/Writing_a_custom_driver/Writing_a_custom_driver.html">Writing a custom driver</a></li><li class='Nav__item '><a href="../The_DB_layer/Writing_a_custom_driver/Metadata.html">Metadata</a></li><li class='Nav__item '><a href="../The_DB_layer/Writing_a_custom_driver/Operation.html">Operation</a></li><li class='Nav__item '><a href="../The_DB_layer/Writing_a_custom_driver/Query.html">Query</a></li><li class='Nav__item '><a href="../The_DB_layer/Writing_a_custom_driver/Storage.html">Storage</a></li></ul></li></ul></li><li class='Nav__item  has-children'><a href="../Uncovered_API/Managers.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Uncovered API</a><ul class='Nav'><li class='Nav__item '><a href="../Uncovered_API/Managers.html">Managers</a></li><li class='Nav__item '><a href="../Uncovered_API/Slack_how_to.html">Slack how to</a></li></ul></li><li class='Nav__item '><a href="../Tests.html">Tests</a></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/roysegall/nuntius-bot" target="_blank">GitHub Repo</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <a class="CodeToggler__button CodeToggler__button--main" href="#">Show Code Blocks Inline</a><br>
                                            </div>
                
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../Tasks/introduction.html">Tasks</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../Tasks/Black_box_task.html">Black box task</a></h1>
                    </div>


    <div class="s-content">
        <pre><code class="language-php">&lt;?php

namespace Nuntius\Tasks;

/**
 * Remind to the user something to do.
 */
class Reminders extends TaskBaseAbstract implements TaskBaseInterface {

  /**
   * {@inheritdoc}
   */
  public function scope() {
    return [
      '/remind me (.*)/' =&gt; [
        'human_command' =&gt; 'remind me REMINDER',
        'description' =&gt; 'Next time you log in I will remind you what you '
        . ' wrote in the REMINDER',
        'callback' =&gt; 'addReminder',
      ],
    ];
  }

  /**
   * Adding a reminder to the DB.
   *
   * @param string $reminder
   *   The reminder of the user.
   *
   * @return string
   *   You got it dude!
   */
  public function addReminder($reminder) {
    $this-&gt;reminders-&gt;save([
      'reminder' =&gt; $reminder,
      'user' =&gt; $this-&gt;data['user'],
    ]);

    return 'OK! I got you covered!';
  }

}
</code></pre>
<p>In the <code>method</code> scope we define to which text we need to respond. Each <code>(.*)</code> is
an argument. The keys meaning are:</p>
<ul>
<li>
<code>human_command</code>: An example of how user input should be.</li>
<li>
<code>description</code>: Describing what the command will do.</li>
<li>
<code>callback</code>: The callback which will be invoked with the argument you expect
to receive.</li>
</ul>
<h2 id="page_Tasks+and+multiple+bots">Tasks and multiple bots</h2>
<p>In <a href="../Multiple_bots_and_context_manager.html">Multiple bots and context manager</a>
we talked on context manager and how we can handle multiple bots. Now, let's see
how tasks are being handle in when we have multiple bots.</p>
<p>In the section above you can see a command declaration. When the the callback is
a string, and the task manager found that the given text from the user match
a structure of a task the function will be invoke in any bot platform.</p>
<p>The problem is - different platforms have different variables and need different
format of the message the user will get. In order to solve that, the callback
can be converted into array and will keyed in a structure of
<code>platform =&gt; callback</code>. Let's see how the help task solve that:</p>
<pre><code class="language-php">  /**
   * {@inheritdoc}
   */
  public function scope() {
    return [
      '/help/' =&gt; [
        'human_command' =&gt; 'help',
        'description' =&gt; 'Giving you help',
        'callback' =&gt; [
          'slack' =&gt; 'slackListOfScopes',
          'facebook' =&gt; 'facebookListOfScopes',
        ],
      ],
    ];
  }
  
  /**
   * Get all the tasks and their scope(except for this one).
   */
  public function slackListOfScopes() {
    $task_manager = Nuntius::getTasksManager();

    $text = [];

    foreach ($task_manager-&gt;getTasks() as $task_id =&gt; $task) {
      if ($task_id == 'help') {
        continue;
      }

      foreach ($task-&gt;scope() as $scope) {
        $text[] = '`' . $scope['human_command'] . '`: ' . $scope['description'];
      }
    }

    return implode(&quot;\n&quot;, $text);
  }

  /**
   * A Facebook only text.
   *
   * Facebook allows to send only 3 buttons - this what we will do.
   */
  public function facebookListOfScopes() {
    $send_api = Nuntius::facebookSendApi();

    return $send_api-&gt;templates-&gt;button
      -&gt;text('hey there! This is the default help response ' .
      'You can try this one and override it later on. ' .
      'Hope you will get some ideas :)')
      -&gt;addButton($send_api-&gt;buttons-&gt;postBack-&gt;title('Say something nice')-&gt;payload('something_nice'))
      -&gt;addButton($send_api-&gt;buttons-&gt;postBack-&gt;reset()-&gt;title(&quot;What's my name?&quot;)-&gt;payload('what_is_my_name'))
      -&gt;addButton($send_api-&gt;buttons-&gt;postBack-&gt;reset()-&gt;title('Toss a coin?')-&gt;payload('toss_a_coin'));
  }
</code></pre>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Tasks/introduction.html">Previous</a></li>            <li class=Pager--next><a href="../Tasks/Conversation_task.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-98663880-1', '');
    ga('send', 'pageview');
</script>

    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
